# Алгоритм работы приложения "Дневник питания"

Этот документ описывает пошаговый алгоритм работы приложения, включая основные ветвления логики.

## 1. Запуск и инициализация

1.  **Старт приложения**: Выполняется метод `Main()`.
2.  **Инициализация базы данных**:
    -   Вызывается метод `Database.InitializeDatabase()`.
    -   **Проверка/создание таблиц**:
        -   **ЕСЛИ** таблица `food` не существует, она создаётся.
        -   **ЕСЛИ** таблица `daily_log` не существует, она создаётся.
3.  **Импорт данных из CSV**:
    -   **Проверка на существование файла**: Проверяется, существует ли файл `Food_Nutrition_Dataset.csv`.
    -   **Проверка на пустоту базы данных**:
        -   **ЕСЛИ** файл существует, выполняется запрос `SELECT COUNT(*) FROM food`.
        -   **ЕСЛИ** результат запроса равен 0 (база данных пуста), то запускается импорт данных.
    -   **Процесс импорта**:
        -   Каждая строка из `Food_Nutrition_Dataset.csv` считывается.
        -   Данные из строки добавляются в таблицу `food` с помощью команды `INSERT OR IGNORE` (игнорирует дубликаты).
4.  **Запуск основного окна**: Создаётся и отображается главный экран приложения (`Form1`).

## 2. Вкладка "Дневник"

### 2.1. Поиск продукта

1.  Пользователь вводит текст в поле поиска.
2.  Пользователь нажимает кнопку "Найти".
3.  **Ветвление (проверка ввода)**:
    -   **ЕСЛИ** поле поиска не пустое:
        -   Выполняется SQL-запрос к таблице `food`: `SELECT * FROM food WHERE food_name LIKE '%текст_поиска%'`.
        -   Результаты поиска отображаются в списке `foodListBox`.
    -   **ИНАЧЕ**: Ничего не происходит.

### 2.2. Добавление продукта в дневник

1.  Пользователь выбирает продукт из списка `foodListBox`.
2.  Пользователь нажимает кнопку "Добавить".
3.  **Ветвление (проверка выбора)**:
    -   **ЕСЛИ** продукт выбран:
        -   Открывается диалоговое окно с запросом веса продукта в граммах.
        -   **Ветвление (действие пользователя в диалоге)**:
            -   **ЕСЛИ** пользователь вводит вес и нажимает "Ok":
                -   **Ветвление (проверка корректности веса)**:
                    -   **ЕСЛИ** введённое значение — это положительное число:
                        -   В таблицу `daily_log` добавляется новая запись с датой, названием продукта и весом.
                        -   Обновляется список продуктов `dailyLogListBox` за текущий день.
                        -   Обновляются итоговые значения калорий и питательных веществ.
                    -   **ИНАЧЕ**: Появляется сообщение об ошибке "Введите корректный вес".
            -   **ЕСЛИ** пользователь нажимает "Отмена": Диалоговое окно закрывается, никаких действий не происходит.
    -   **ИНАЧЕ**: Ничего не происходит.

### 2.3. Удаление продукта из дневника

1.  Пользователь выбирает продукт из списка `dailyLogListBox`.
2.  Пользователь нажимает кнопку "Удалить".
3.  **Ветвление (проверка выбора)**:
    -   **ЕСЛИ** продукт выбран:
        -   Из таблицы `daily_log` удаляется соответствующая запись по её `id`.
        -   Обновляется список `dailyLogListBox` и итоговые значения.
    -   **ИНАЧЕ**: Ничего не происходит.

## 3. Вкладка "История"

1.  Пользователь выбирает дату в `historyDateTimePicker`.
2.  Автоматически загружается история за выбранный день (аналогично загрузке дневника).
3.  **Редактирование записи**:
    -   Пользователь выбирает продукт в списке `historyListBox` и нажимает "Редактировать".
    -   Открывается диалоговое окно для изменения веса (логика аналогична добавлению продукта).
    -   **ЕСЛИ** введён новый корректный вес:
        -   Выполняется SQL-запрос `UPDATE daily_log SET weight = новый_вес WHERE id = id_записи`.
        -   Список и итоговые значения на вкладке "История" обновляются.

## 4. Вкладка "Калькулятор калорий"

1.  **Выбор формулы**:
    -   Пользователь выбирает одну из трёх формул в `formulaComboBox`.
    -   **Ветвление (выбор формулы)**:
        -   **ЕСЛИ** выбрана формула "Katch-McArdle":
            -   На форме появляется дополнительное поле для ввода процента жира в организме.
        -   **ИНАЧЕ**: Поле для ввода процента жира скрыто.
2.  **Расчёт**:
    -   Пользователь вводит свои данные (пол, вес, рост, возраст и др.).
    -   Пользователь нажимает кнопку "Рассчитать".
    -   **Проверка введённых данных**:
        -   **ЕСЛИ** вес, рост или возраст меньше или равны нулю, появляется сообщение об ошибке.
    -   **Выбор алгоритма расчёта**:
        -   В зависимости от выбранной формулы, вызывается соответствующий метод для расчёта **базального метаболизма (BMR)**.
    -   Рассчитывается **суточная потребность в калориях (TDEE)** путём умножения BMR на коэффициент активности.
    -   Результаты (BMR и TDEE) отображаются на экране.
